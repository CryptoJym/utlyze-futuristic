<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Menu Test - Utlyze</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Test helper styles */
        .test-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            z-index: 999999;
            max-width: 300px;
        }
        .test-info h3 {
            margin: 0 0 10px 0;
            color: #00ff00;
        }
        .test-info .status {
            margin: 5px 0;
        }
        .test-info .success {
            color: #00ff00;
        }
        .test-info .error {
            color: #ff0000;
        }
        .test-info .info {
            color: #ffff00;
        }
        
        /* Force mobile view for testing */
        @media (min-width: 901px) {
            .force-mobile .nav-links {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                display: flex !important;
                flex-direction: column !important;
                transform: translateX(-100%) !important;
                opacity: 0 !important;
                visibility: hidden !important;
            }
            .force-mobile .nav-links.nav-links--open {
                transform: translateX(0) !important;
                opacity: 1 !important;
                visibility: visible !important;
            }
            .force-mobile .nav-toggle {
                display: flex !important;
            }
        }
    </style>
</head>
<body class="force-mobile">
    <!-- Test content -->
    <div style="padding: 20px;">
        <h1>Mobile Menu Test Page</h1>
        <p>This page tests the mobile navigation menu functionality.</p>
        <button id="force-mobile-toggle" style="margin: 20px 0; padding: 10px 20px;">Toggle Force Mobile View</button>
    </div>

    <!-- Site Header Mount Point -->
    <div id="site-header-mount"></div>
    
    <!-- Test info panel -->
    <div class="test-info" id="test-info">
        <h3>Mobile Menu Test Status</h3>
        <div id="test-status"></div>
    </div>

    <!-- Site Footer Mount Point -->
    <div id="site-footer-mount"></div>

    <script src="app.js"></script>
    <script>
        // Test monitoring script
        let testLog = [];
        let clickCount = 0;
        let menuStateChanges = 0;
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            testLog.push({timestamp, message, type});
            updateStatus();
        }
        
        function updateStatus() {
            const statusEl = document.getElementById('test-status');
            const navMenu = document.querySelector('.nav-links');
            const menuToggle = document.querySelector('.nav-toggle');
            const isMenuOpen = navMenu && navMenu.classList.contains('nav-links--open');
            
            let html = `
                <div class="status ${menuToggle ? 'success' : 'error'}">Toggle Button: ${menuToggle ? 'Found' : 'Not Found'}</div>
                <div class="status ${navMenu ? 'success' : 'error'}">Nav Menu: ${navMenu ? 'Found' : 'Not Found'}</div>
                <div class="status info">Menu State: ${isMenuOpen ? 'OPEN' : 'CLOSED'}</div>
                <div class="status info">Toggle Clicks: ${clickCount}</div>
                <div class="status info">State Changes: ${menuStateChanges}</div>
                <hr style="margin: 10px 0; opacity: 0.3;">
                <div style="max-height: 150px; overflow-y: auto;">
            `;
            
            // Show last 10 log entries
            testLog.slice(-10).reverse().forEach(entry => {
                html += `<div class="status ${entry.type}">[${entry.timestamp}] ${entry.message}</div>`;
            });
            
            html += '</div>';
            statusEl.innerHTML = html;
        }
        
        // Wait for DOM and partials to load
        setTimeout(() => {
            const menuToggle = document.querySelector('.nav-toggle');
            const navMenu = document.querySelector('.nav-links');
            
            if (menuToggle) {
                log('Menu toggle button found', 'success');
                
                // Monitor toggle clicks
                menuToggle.addEventListener('click', () => {
                    clickCount++;
                    log(`Toggle clicked (#${clickCount})`, 'info');
                });
                
                // Monitor menu state changes
                if (navMenu) {
                    log('Navigation menu found', 'success');
                    
                    const observer = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            if (mutation.attributeName === 'class') {
                                const isOpen = navMenu.classList.contains('nav-links--open');
                                menuStateChanges++;
                                log(`Menu state changed to: ${isOpen ? 'OPEN' : 'CLOSED'}`, isOpen ? 'success' : 'info');
                            }
                        });
                    });
                    
                    observer.observe(navMenu, {
                        attributes: true,
                        attributeFilter: ['class']
                    });
                } else {
                    log('Navigation menu NOT found', 'error');
                }
                
                // Monitor document clicks
                document.addEventListener('click', (e) => {
                    if (!menuToggle.contains(e.target) && !navMenu.contains(e.target)) {
                        if (navMenu.classList.contains('nav-links--open')) {
                            log('Document click detected (menu open)', 'info');
                        }
                    }
                });
                
                // Monitor escape key
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && navMenu.classList.contains('nav-links--open')) {
                        log('Escape key pressed (menu open)', 'info');
                    }
                });
                
            } else {
                log('Menu toggle button NOT found', 'error');
            }
            
            updateStatus();
        }, 1000);
        
        // Force mobile toggle
        document.getElementById('force-mobile-toggle').addEventListener('click', () => {
            document.body.classList.toggle('force-mobile');
            log(`Force mobile view: ${document.body.classList.contains('force-mobile') ? 'ON' : 'OFF'}`, 'info');
        });
        
        // Update status every second
        setInterval(updateStatus, 1000);
    </script>
</body>
</html>